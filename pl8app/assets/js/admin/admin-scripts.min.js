jQuery(document).ready(function($){pl8app_attach_tooltips($(".pl8app-help-tip"));var pl8app_Menuitem_Configuration={init:function(){this.add(),this.move(),this.remove(),this.type(),this.prices(),this.files(),this.updatePrices()},clone_repeatable:function(row){var key=highest=1;return row.parent().find(".pl8app_repeatable_row").each(function(){var current=$(this).data("key");parseInt(current)>highest&&(highest=current)}),key=highest+=1,clone=row.clone(),clone.removeClass("pl8app_add_blank"),clone.attr("data-key",key),clone.find("input, select, textarea").val("").each(function(){var name=$(this).attr("name"),id=$(this).attr("id");name&&(name=name.replace(/\[(\d+)\]/,"["+parseInt(key)+"]"),$(this).attr("name",name)),$(this).attr("data-key",key),void 0!==id&&(id=id.replace(/(\d+)/,parseInt(key)),$(this).attr("id",id))}),clone.find("select").each(function(){$(this).val(row.find('select[name="'+$(this).attr("name")+'"]').val())}),clone.find('input[type="checkbox"]').each(function(){$(this).is(":checked")&&$(this).prop("checked",!1),$(this).val(1)}),clone.find("span.pl8app_price_id").each(function(){$(this).text(parseInt(key))}),clone.find("span.pl8app_file_id").each(function(){$(this).text(parseInt(key))}),clone.find(".pl8app_repeatable_default_input").each(function(){$(this).val(parseInt(key)).removeAttr("checked")}),clone.find(".pl8app_repeatable_condition_field").each(function(){$(this).find("option:eq(0)").prop("selected","selected")}),clone.find(".search-choice").remove(),clone.find(".chosen-container").remove(),pl8app_attach_tooltips(clone.find(".pl8app-help-tip")),clone},add:function(){$(document.body).on("click",".submit .pl8app_add_repeatable",function(e){e.preventDefault();var row=$(this).parent().parent().prev(".pl8app_repeatable_row"),clone=pl8app_Menuitem_Configuration.clone_repeatable(row);clone.insertAfter(row).find("input, textarea, select").filter(":visible").eq(0).focus(),clone.find(".pl8app-select-chosen").chosen({inherit_select_classes:!0,placeholder_text_single:pl8app_vars.one_option,placeholder_text_multiple:pl8app_vars.one_or_more_option}),clone.find(".pl8app-select-chosen").css("width","100%"),clone.find(".pl8app-select-chosen .chosen-search input").attr("placeholder",pl8app_vars.search_placeholder)})},move:function(){$(".pl8app_repeatable_table .pl8app-repeatables-wrap").sortable({handle:".pl8app-draghandle-anchor",items:".pl8app_repeatable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var count=0;$(this).find(".pl8app_repeatable_row").each(function(){$(this).find("input.pl8app_repeatable_index").each(function(){$(this).val(count)}),count++})}})},remove:function(){$(document.body).on("click",".pl8app-remove-row, .pl8app_remove_repeatable",function(e){e.preventDefault();var firstFocusable,row=$(this).parents(".pl8app_repeatable_row"),count=row.parent().find(".pl8app_repeatable_row").length,type=$(this).data("type"),repeatable="div.pl8app_repeatable_"+type+"s";if(firstFocusable=($(this).is(".ui-sortable .pl8app_repeatable_row:first-child .pl8app-remove-row, .ui-sortable .pl8app_repeatable_row:first-child .pl8app_remove_repeatable")?row.next(".pl8app_repeatable_row"):row.prev(".pl8app_repeatable_row")).find("select, input, textarea, button").filter(":visible").eq(0),"price"===type){var price_row_id=row.data("key");$('.pl8app_repeatable_condition_field option[value="'+price_row_id+'"]').remove()}if(1<count)$("input, select",row).val(""),row.fadeOut("fast").remove(),firstFocusable.focus();else switch(type){case"price":alert(pl8app_vars.one_price_min);break;case"file":$("input, select",row).val("");break;default:alert(pl8app_vars.one_field_min)}$(repeatable).each(function(rowIndex){$(this).find("input, select").each(function(){var name=$(this).attr("name");name=name.replace(/\[(\d+)\]/,"["+rowIndex+"]"),$(this).attr("name",name).attr("id",name)})})})},type:function(){$(document.body).on("change","#_pl8app_product_type",function(e){var pl8app_products=$("#pl8app_products"),pl8app_menuitem_files=$("#pl8app_menuitem_files"),pl8app_menuitem_limit_wrap=$("#pl8app_menuitem_limit_wrap");"bundle"===$(this).val()?(pl8app_products.show(),pl8app_menuitem_files.hide(),pl8app_menuitem_limit_wrap.hide()):(pl8app_products.hide(),pl8app_menuitem_files.show(),pl8app_menuitem_limit_wrap.show())})},prices:function(){$(document.body).on("change","#pl8app_variable_pricing",function(e){var checked=$(this).is(":checked"),single=$("#pl8app_regular_price_field"),variable=$("#pl8app_variable_price_fields, .pl8app_repeatable_table .pricing"),bundleRow=$(".pl8app-bundled-product-row, .pl8app-repeatable-row-standard-fields");checked?(single.hide(),variable.show(),bundleRow.addClass("has-variable-pricing")):(single.show(),variable.hide(),bundleRow.removeClass("has-variable-pricing"))})},files:function(){var file_frame;window.formfield="",$(document.body).on("click",".pl8app_upload_file_button",function(e){e.preventDefault();var button=$(this);window.formfield=$(this).closest(".pl8app_repeatable_upload_wrapper"),file_frame||((file_frame=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:button.data("uploader-title"),button:{text:button.data("uploader-button-text")},multiple:"0"!=$(this).data("multiple")})).on("menu:render:default",function(view){view.unset("library-separator"),view.unset("gallery"),view.unset("featured-image"),view.unset("embed"),view.set({})}),file_frame.on("insert",function(){file_frame.state().get("selection").each(function(attachment,index){var selectedSize="image"===(attachment=attachment.toJSON()).type&&$(".attachment-display-settings .size option:selected").val(),selectedURL=attachment.url,selectedName=0<attachment.title.length?attachment.title:attachment.filename;if(selectedSize&&void 0!==attachment.sizes[selectedSize]&&(selectedURL=attachment.sizes[selectedSize].url),"image"===attachment.type&&(selectedName=selectedSize&&void 0!==attachment.sizes[selectedSize]?selectedName+"-"+attachment.sizes[selectedSize].width+"x"+attachment.sizes[selectedSize].height:selectedName+"-"+attachment.width+"x"+attachment.height),0===index)window.formfield.find(".pl8app_repeatable_attachment_id_field").val(attachment.id),window.formfield.find(".pl8app_repeatable_thumbnail_size_field").val(selectedSize),window.formfield.find(".pl8app_repeatable_upload_field").val(selectedURL),window.formfield.find(".pl8app_repeatable_name_field").val(selectedName);else{var row=window.formfield,clone=pl8app_Menuitem_Configuration.clone_repeatable(row);clone.find(".pl8app_repeatable_attachment_id_field").val(attachment.id),clone.find(".pl8app_repeatable_thumbnail_size_field").val(selectedSize),clone.find(".pl8app_repeatable_upload_field").val(selectedURL),clone.find(".pl8app_repeatable_name_field").val(selectedName),clone.insertAfter(row)}})})),file_frame.open()}),window.formfield=""},updatePrices:function(){$("#pl8app_price_fields").on("keyup",".pl8app_variable_prices_name",function(){var key=$(this).parents(".pl8app_repeatable_row").data("key"),name=$(this).val(),field_option=$(".pl8app_repeatable_condition_field option[value="+key+"]");0<field_option.length?field_option.text(name):$(".pl8app_repeatable_condition_field").append($("<option></option>").attr("value",key).text(name))})}};$(document.body).on("click",".toggle-custom-price-option-section",function(e){e.preventDefault();var show=$(this).html()==pl8app_vars.show_advanced_settings;show?$(this).html(pl8app_vars.hide_advanced_settings):$(this).html(pl8app_vars.show_advanced_settings);var header=$(this).parents(".pl8app-repeatable-row-header");header.siblings(".pl8app-custom-price-option-sections-wrap").slideToggle(),$(":input:not(input[type=button],input[type=submit],button):visible:first",show?header.siblings(".pl8app-custom-price-option-sections-wrap"):header.siblings(".pl8app-repeatable-row-standard-fields")).focus()}),pl8app_Menuitem_Configuration.init();var typingTimer,pl8app_datepicker=$(".pl8app_datepicker");if(0<pl8app_datepicker.length){pl8app_datepicker.datepicker({dateFormat:"mm/dd/yy"})}({init:function(){this.edit_address(),this.remove_menuitem(),this.add_menuitem(),this.change_customer(),this.new_customer(),this.edit_price(),this.recalculate_total(),this.variable_prices_check(),this.add_note(),this.remove_note(),this.resend_receipt(),this.copy_menuitem_link()},edit_address:function(){$('select[name="pl8app-payment-address[0][country]"]').change(function(){var data={action:"pl8app_get_states",country:$(this).val(),field_name:"pl8app-payment-address[0][state]"};return $.post(ajaxurl,data,function(response){var state_wrapper=$("#pl8app-order-address-state-wrap select, #pl8app-order-address-state-wrap input");$("#pl8app-order-address-state-wrap .chosen-container").remove(),"nostates"==response?state_wrapper.replaceWith('<input type="text" name="pl8app-payment-address[0][state]" value="" class="pl8app-edit-toggles medium-text"/>'):state_wrapper.replaceWith(response)}),!1})},remove_menuitem:function(){$("#pl8app-purchased-items").on("click",".pl8app-order-remove-menuitem",function(){if(1===$(document.body).find("#pl8app-purchased-items > .row:not(.header)").length)return alert(pl8app_vars.one_menuitem_min),!1;if(confirm(pl8app_vars.delete_payment_menuitem)){var key=$(this).data("key"),menuitem_id=($(".pl8app-payment-id").val(),$('input[name="pl8app-payment-details-menuitems['+key+'][id]"]').val()),price_id=$('input[name="pl8app-payment-details-menuitems['+key+'][price_id]"]').val(),quantity=$('input[name="pl8app-payment-details-menuitems['+key+'][quantity]"]').val(),amount=$('input[name="pl8app-payment-details-menuitems['+key+'][amount]"]').val();if($('input[name="pl8app-payment-details-menuitems['+key+'][tax]"]'))var fees=$('input[name="pl8app-payment-details-menuitems['+key+'][tax]"]').val();if($('input[name="pl8app-payment-details-menuitems['+key+'][fees]"]'))fees=$.parseJSON($('input[name="pl8app-payment-details-menuitems['+key+'][fees]"]').val());var currently_removed=$('input[name="pl8app-payment-removed"]').val();(currently_removed=$.parseJSON(currently_removed)).length<1&&(currently_removed={});var removed_item=[{id:menuitem_id,price_id:price_id,quantity:quantity,amount:amount,cart_index:key}];currently_removed[key]=removed_item,$('input[name="pl8app-payment-removed"]').val(JSON.stringify(currently_removed)),$(this).parent().parent().remove(),fees&&fees.length&&$.each(fees,function(key,value){$('*li[data-fee-id="'+value+'"]').remove()}),$("#pl8app-payment-menuitems-changed").val(1),$(".pl8app-order-payment-recalc-totals").show()}return!1})},change_customer:function(){$("#pl8app-customer-details").on("click",".pl8app-payment-change-customer, .pl8app-payment-change-customer-cancel",function(e){e.preventDefault();var change_customer=$(this).hasClass("pl8app-payment-change-customer"),cancel=$(this).hasClass("pl8app-payment-change-customer-cancel");change_customer?($(".customer-info").hide(),$(".change-customer").show(),$(".pl8app-payment-change-customer-input").css("width","auto")):cancel&&($(".customer-info").show(),$(".change-customer").hide())})},new_customer:function(){$("#pl8app-customer-details").on("click",".pl8app-payment-new-customer, .pl8app-payment-new-customer-cancel",function(e){e.preventDefault();var new_customer=$(this).hasClass("pl8app-payment-new-customer"),cancel=$(this).hasClass("pl8app-payment-new-customer-cancel");new_customer?($(".customer-info").hide(),$(".new-customer").show()):cancel&&($(".customer-info").show(),$(".new-customer").hide());new_customer=$("#pl8app-new-customer");$(".new-customer").is(":visible")?new_customer.val(1):new_customer.val(0)})},add_menuitem:function(){$(".pl8app-edit-purchase-element").on("click","#pl8app-order-add-menuitem",function(e){e.preventDefault();var order_menuitem_select=$("#pl8app_order_menuitem_select"),order_menuitem_quantity=$("#pl8app-order-menuitem-quantity"),order_menuitem_price=$("#pl8app-order-menuitem-price"),order_menuitem_tax=$("#pl8app-order-menuitem-tax"),selected_price_option=$(".pl8app_price_options_select option:selected"),menuitem_id=order_menuitem_select.val(),menuitem_title=order_menuitem_select.find(":selected").text(),quantity=order_menuitem_quantity.val(),item_price=order_menuitem_price.val(),item_tax=order_menuitem_tax.val(),price_id=selected_price_option.val(),price_name=selected_price_option.text();if(menuitem_id<1)return!1;if(item_price||(item_price=0),item_price=parseFloat(item_price),isNaN(item_price))return alert(pl8app_vars.numeric_item_price),!1;if(item_tax=parseFloat(item_tax),isNaN(item_tax))return alert(pl8app_vars.numeric_item_tax),!1;if(isNaN(parseInt(quantity)))return alert(pl8app_vars.numeric_quantity),!1;price_name&&(menuitem_title=menuitem_title+" - "+price_name);var count=$("#pl8app-purchased-items div.row").length,clone=$("#pl8app-purchased-items div.row:last").clone();clone.find(".menuitem span").html('<a href="post.php?post='+menuitem_id+'&action=edit"></a>'),clone.find(".menuitem span a").text(menuitem_title),clone.find(".pl8app-payment-details-menuitem-item-price").val(item_price.toFixed(pl8app_vars.currency_decimals)),clone.find(".pl8app-payment-details-menuitem-item-tax").val(item_tax.toFixed(pl8app_vars.currency_decimals)),clone.find("input.pl8app-payment-details-menuitem-id").val(menuitem_id),clone.find("input.pl8app-payment-details-menuitem-price-id").val(price_id);var item_total=item_price*quantity+item_tax;item_total=item_total.toFixed(pl8app_vars.currency_decimals),clone.find("span.pl8app-payment-details-menuitem-amount").text(item_total),clone.find("input.pl8app-payment-details-menuitem-amount").val(item_total),clone.find("input.pl8app-payment-details-menuitem-quantity").val(quantity),clone.find("input.pl8app-payment-details-menuitem-has-log").val(0),clone.find(".pl8app-copy-menuitem-link-wrapper").remove(),clone.find("input").each(function(){var name=$(this).attr("name");name=name.replace(/\[(\d+)\]/,"["+parseInt(count)+"]"),$(this).attr("name",name).attr("id",name)}),clone.find("a.pl8app-order-remove-menuitem").attr("data-key",parseInt(count)),$("#pl8app-payment-menuitems-changed").val(1),$(clone).insertAfter("#pl8app-purchased-items div.row:last"),$(".pl8app-order-payment-recalc-totals").show(),$(".pl8app-add-menuitem-field").val("")})},edit_price:function(){$(document.body).on("change keyup",".pl8app-payment-item-input",function(){var row=$(this).parents("ul.pl8app-purchased-items-list-wrapper");$(".pl8app-order-payment-recalc-totals").show();var quantity=row.find("input.pl8app-payment-details-menuitem-quantity").val().replace(pl8app_vars.thousands_separator,""),item_price=row.find("input.pl8app-payment-details-menuitem-item-price").val().replace(pl8app_vars.thousands_separator,""),item_tax=row.find("input.pl8app-payment-details-menuitem-item-tax").val().replace(pl8app_vars.thousands_separator,"");if(item_price=parseFloat(item_price),isNaN(item_price))return alert(pl8app_vars.numeric_item_price),!1;item_tax=parseFloat(item_tax),isNaN(item_tax)&&(item_tax=0),isNaN(parseInt(quantity))&&(quantity=1);var item_total=item_price*quantity+item_tax;item_total=item_total.toFixed(pl8app_vars.currency_decimals),row.find("input.pl8app-payment-details-menuitem-amount").val(item_total),row.find("span.pl8app-payment-details-menuitem-amount").text(item_total)})},recalculate_total:function(){$("#pl8app-order-recalc-total").on("click",function(e){e.preventDefault();var total=0,tax=0,totals=$("#pl8app-purchased-items .row input.pl8app-payment-details-menuitem-amount"),taxes=$("#pl8app-purchased-items .row input.pl8app-payment-details-menuitem-item-tax");totals.length&&totals.each(function(){total+=parseFloat($(this).val())}),taxes.length&&taxes.each(function(){tax+=parseFloat($(this).val())}),$(".pl8app-payment-fees").length&&$(".pl8app-payment-fees span.fee-amount").each(function(){total+=parseFloat($(this).data("fee"))}),$("input[name=pl8app-payment-total]").val(total.toFixed(pl8app_vars.currency_decimals)),$("input[name=pl8app-payment-tax]").val(tax.toFixed(pl8app_vars.currency_decimals))})},variable_prices_check:function(){$(".pl8app-edit-purchase-element").on("change","select#pl8app_order_menuitem_select",function(){var $this=$(this),menuitem_id=$this.val();if(0<parseInt(menuitem_id)){var postData={action:"pl8app_check_for_menuitem_price_variations",menuitem_id:menuitem_id};$.ajax({type:"POST",data:postData,url:ajaxurl,success:function(response){$(".pl8app_price_options_select").remove(),$(response).insertAfter($this.next())}}).fail(function(data){window.console&&window.console.log&&console.log(data)})}})},add_note:function(){$("#pl8app-add-payment-note").on("click",function(e){e.preventDefault();var postData={action:"pl8app_insert_payment_note",payment_id:$(this).data("payment-id"),note:$("#pl8app-payment-note").val()};if(postData.note)$.ajax({type:"POST",data:postData,url:ajaxurl,success:function(response){$("#pl8app-payment-notes-inner").append(response),$(".pl8app-no-payment-notes").hide(),$("#pl8app-payment-note").val("")}}).fail(function(data){window.console&&window.console.log&&console.log(data)});else{var border_color=$("#pl8app-payment-note").css("border-color");$("#pl8app-payment-note").css("border-color","red"),setTimeout(function(){$("#pl8app-payment-note").css("border-color",border_color)},500)}})},remove_note:function(){$(document.body).on("click",".pl8app-delete-payment-note",function(e){if(e.preventDefault(),confirm(pl8app_vars.delete_payment_note)){var postData={action:"pl8app_delete_payment_note",payment_id:$(this).data("payment-id"),note_id:$(this).data("note-id")};return $.ajax({type:"POST",data:postData,url:ajaxurl,success:function(response){return $("#pl8app-payment-note-"+postData.note_id).remove(),$(".pl8app-payment-note").length||$(".pl8app-no-payment-notes").show(),!1}}).fail(function(data){window.console&&window.console.log&&console.log(data)}),!0}})},resend_receipt:function(){var emails_wrap=$(".pl8app-order-resend-receipt-addresses");$(document.body).on("click","#pl8app-select-receipt-email",function(e){e.preventDefault(),emails_wrap.slideDown()}),$(document.body).on("change",".pl8app-order-resend-receipt-email",function(){var href=$("#pl8app-select-receipt-email").prop("href")+"&email="+$(this).val();confirm(pl8app_vars.resend_receipt)&&(window.location=href)}),$(document.body).on("click","#pl8app-resend-receipt",function(e){return confirm(pl8app_vars.resend_receipt)})},copy_menuitem_link:function(){$(document.body).on("click",".pl8app-copy-menuitem-link",function(e){e.preventDefault();var $this=$(this),postData={action:"pl8app_get_file_menuitem_link",payment_id:$('input[name="pl8app_payment_id"]').val(),menuitem_id:$this.data("menuitem-id"),price_id:$this.data("price-id")};$.ajax({type:"POST",data:postData,url:ajaxurl,success:function(link){return $("#pl8app-menuitem-link").dialog({width:400}).html('<textarea rows="10" cols="40" id="pl8app-menuitem-link-textarea">'+link+"</textarea>"),$("#pl8app-menuitem-link-textarea").focus().select(),!1}}).fail(function(data){window.console&&window.console.log&&console.log(data)})})}}).init(),{init:function(){this.type_select(),this.product_requirements()},type_select:function(){$("#pl8app-edit-discount #pl8app-type, #pl8app-add-discount #pl8app-type").change(function(){var val=$(this).val();$(".pl8app-amount-description").hide(),$(".pl8app-amount-description."+val+"-discount").show()})},product_requirements:function(){$("#products").change(function(){var product_conditions=$("#pl8app-discount-product-conditions");$(this).val()?product_conditions.show():product_conditions.hide()})}}.init(),{init:function(){this.date_options(),this.customers_export()},date_options:function(){$("#pl8app-graphs-date-options").change(function(){var $this=$(this),date_range_options=$("#pl8app-date-range-options");"other"===$this.val()?date_range_options.show():date_range_options.hide()})},customers_export:function(){$("#pl8app_customer_export_menuitem").change(function(){var $this=$(this),menuitem_id=$("option:selected",$this).val(),customer_export_option=$("#pl8app_customer_export_option");if("0"===$this.val()?customer_export_option.show():customer_export_option.hide(),0!=parseInt(menuitem_id)){var data={action:"pl8app_check_for_menuitem_price_variations",menuitem_id:menuitem_id,all_prices:!0},price_options_select=$(".pl8app_price_options_select");$.post(ajaxurl,data,function(response){price_options_select.remove(),$("#pl8app_customer_export_menuitem_chosen").after(response)})}else price_options_select.remove()})}}.init(),{init:function(){this.general(),this.taxes(),this.emails(),this.misc()},general:function(){var pl8app_color_picker=$(".pl8app-color-picker");if(pl8app_color_picker.length&&pl8app_color_picker.wpColorPicker(),"undefined"==typeof wp||"1"!==pl8app_vars.new_media_ui){var pl8app_settings_upload_button=$(".pl8app_settings_upload_button");0<pl8app_settings_upload_button.length&&(window.formfield="",$(document.body).on("click",pl8app_settings_upload_button,function(e){e.preventDefault(),window.formfield=$(this).parent().prev(),window.tbframe_interval=setInterval(function(){jQuery("#TB_iframeContent").contents().find(".savesend .button").val(pl8app_vars.use_this_file).end().find("#insert-gallery, .wp-post-thumbnail").hide()},2e3),tb_show(pl8app_vars.add_new_menuitem,"media-upload.php?TB_iframe=true")}),window.pl8app_send_to_editor=window.send_to_editor,window.send_to_editor=function(html){window.formfield?(imgurl=$("a","<div>"+html+"</div>").attr("href"),window.formfield.val(imgurl),window.clearInterval(window.tbframe_interval),tb_remove()):window.pl8app_send_to_editor(html),window.send_to_editor=window.pl8app_send_to_editor,window.formfield="",window.imagefield=!1})}else{var file_frame;window.formfield="",$(document.body).on("click",".pl8app_settings_upload_button",function(e){e.preventDefault();var button=$(this);window.formfield=$(this).parent().prev(),file_frame||((file_frame=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:button.data("uploader_title"),button:{text:button.data("uploader_button_text")},multiple:!1})).on("menu:render:default",function(view){view.unset("library-separator"),view.unset("gallery"),view.unset("featured-image"),view.unset("embed"),view.set({})}),file_frame.on("insert",function(){file_frame.state().get("selection").each(function(attachment,index){attachment=attachment.toJSON(),window.formfield.val(attachment.url)})})),file_frame.open()}),window.formfield=""}},taxes:function(){var no_states=$("select.pl8app-no-states");no_states.length&&no_states.closest("tr").addClass("hidden"),$('select[name="pl8app_settings[base_country]"]').change(function(){var $tr=$(this).closest("tr"),data={action:"pl8app_get_states",country:$(this).val(),field_name:"pl8app_settings[base_state]"};return $.post(ajaxurl,data,function(response){"nostates"==response?$tr.next().addClass("hidden"):($tr.next().removeClass("hidden"),$tr.next().find("select").replaceWith(response))}),!1}),$(document.body).on("change","#pl8app_tax_rates select.pl8app-tax-country",function(){var $this=$(this),data={action:"pl8app_get_states",country:$(this).val(),field_name:$this.attr("name").replace("country","state")};return $.post(ajaxurl,data,function(response){if("nostates"==response){var text_field='<input type="text" name="'+data.field_name+'" value=""/>';$this.parent().next().find("select").replaceWith(text_field)}else $this.parent().next().find("input,select").show(),$this.parent().next().find("input,select").replaceWith(response)}),!1}),$("#pl8app_add_tax_rate").on("click",function(){var row=$("#pl8app_tax_rates tr:last"),clone=row.clone(),count=row.parent().find("tr").length;return clone.find("td input").not(":input[type=checkbox]").val(""),clone.find('td [type="checkbox"]').attr("checked",!1),clone.find("input, select").each(function(){var name=$(this).attr("name");name=name.replace(/\[(\d+)\]/,"["+parseInt(count)+"]"),$(this).attr("name",name).attr("id",name)}),clone.find("label").each(function(){var name=$(this).attr("for");name=name.replace(/\[(\d+)\]/,"["+parseInt(count)+"]"),$(this).attr("for",name)}),clone.insertAfter(row),!1}),$(document.body).on("click","#pl8app_tax_rates .pl8app_remove_tax_rate",function(){confirm(pl8app_vars.delete_tax_rate)&&(2===$("#pl8app_tax_rates tr:visible").length?($("#pl8app_tax_rates select").val(""),$('#pl8app_tax_rates input[type="text"]').val(""),$('#pl8app_tax_rates input[type="number"]').val(""),$('#pl8app_tax_rates input[type="checkbox"]').attr("checked",!1)):$(this).closest("tr").remove(),$("#pl8app_tax_rates tr").each(function(rowIndex){$(this).children().find("input, select").each(function(){var name=$(this).attr("name");name=name.replace(/\[(\d+)\]/,"["+(rowIndex-1)+"]"),$(this).attr("name",name).attr("id",name)})}));return!1})},emails:function(){var email_preview_wrap=$("#email-preview-wrap");if(email_preview_wrap.length){var emailPreview=$("#email-preview");email_preview_wrap.colorbox({inline:!0,href:emailPreview,width:"80%",height:"auto"})}},misc:function(){var menuitemMethod=$('select[name="pl8app_settings[menuitem_method]"]'),symlink=menuitemMethod.parent().parent().next();"direct"==menuitemMethod.val()&&(symlink.hide(),symlink.find("input").prop("checked",!1)),menuitemMethod.on("change",function(){"direct"==$(this).val()?(symlink.hide(),symlink.find("input").prop("checked",!1)):symlink.show()})}}.init(),$(".menuitem_page_pl8app-payment-history .row-actions .delete a, a.pl8app-delete-payment").on("click",function(){return!!confirm(pl8app_vars.delete_payment)}),$("body").on("click","#the-list .editinline",function(){var post_id=$(this).closest("tr").attr("id");post_id=post_id.replace("post-","");var regprice=$("#post-"+post_id).find(".column-price .menuitemprice-"+post_id).val();regprice!=$("#post-"+post_id+".column-price .menuitemprice-"+post_id).val()?$(".regprice","#pl8app-menuitem-data").val(regprice).attr("disabled",!1):$(".regprice","#pl8app-menuitem-data").val(pl8app_vars.quick_edit_warning).attr("disabled","disabled")}),$(document.body).on("click","#bulk_edit",function(){var $bulk_row=$("#bulk-edit"),$post_ids=new Array;$bulk_row.find("#bulk-titles").children().each(function(){$post_ids.push($(this).attr("id").replace(/^(ttle)/i,""))});var $price=$('#pl8app-menuitem-data input[name="_pl8app_regprice"]').val(),data={action:"pl8app_save_bulk_edit",pl8app_bulk_nonce:$post_ids,post_ids:$post_ids,price:$price};$.post(ajaxurl,data)}),$(".pl8app-select-chosen").chosen({inherit_select_classes:!0,placeholder_text_single:pl8app_vars.one_option,placeholder_text_multiple:pl8app_vars.one_or_more_option}),$(".pl8app-select-chosen .chosen-search input").each(function(){var selectElem=$(this).parent().parent().parent().prev("select.pl8app-select-chosen"),placeholder=(selectElem.data("search-type"),selectElem.data("search-placeholder"));$(this).attr("placeholder",placeholder)}),$(".chosen-choices").on("click",function(){var placeholder=$(this).parent().prev().data("search-placeholder");void 0===placeholder&&(placeholder=pl8app_vars.type_to_search),$(this).children("li").children("input").attr("placeholder",placeholder)});$(document.body).on("keyup",".pl8app-select.chosen-container .chosen-search input, .pl8app-select.chosen-container .search-field input",function(e){var val=$(this).val(),container=$(this).closest(".pl8app-select-chosen"),select=(container.attr("id").replace("_chosen",""),container.prev()),no_bundles=container.hasClass("no-bundles"),variations=container.hasClass("variations"),lastKey=e.which,search_type="pl8app_menuitem_search";if(container.prev().data("search-type")){if("no_ajax"==select.data("search-type"))return;search_type="pl8app_"+select.data("search-type")+"_search"}val.length<=3&&"pl8app_menuitem_search"==search_type||16==lastKey||13==lastKey||91==lastKey||17==lastKey||37==lastKey||38==lastKey||39==lastKey||40==lastKey||(clearTimeout(typingTimer),typingTimer=setTimeout(function(){$.ajax({type:"GET",url:ajaxurl,data:{action:search_type,s:val,no_bundles:no_bundles,variations:variations},dataType:"json",beforeSend:function(){select.closest("ul.chosen-results").empty()},success:function(data){$("option:not(:selected)",select).remove(),$.each(data,function(key,item){$('option[value="'+item.id+'"]',select).length||select.prepend('<option value="'+item.id+'">'+item.name+"</option>")}),$(".pl8app-select-chosen").trigger("chosen:updated"),select.next().find("input").val(val)}}).fail(function(response){window.console&&window.console.log&&console.log(response)}).done(function(response){})},342))}),$("#post").on("click",".pl8app-thickbox",function(){$(".pl8app-select-chosen","#choose-menuitem").css("width","100%")}),{init:function(){this.revoke_api_key(),this.regenerate_api_key(),this.create_api_key(),this.recount_stats()},revoke_api_key:function(){$(document.body).on("click",".pl8app-revoke-api-key",function(e){return confirm(pl8app_vars.revoke_api_key)})},regenerate_api_key:function(){$(document.body).on("click",".pl8app-regenerate-api-key",function(e){return confirm(pl8app_vars.regenerate_api_key)})},create_api_key:function(){$(document.body).on("submit","#api-key-generate-form",function(e){var input=$('input[type="text"][name="user_id"]');input.css("border-color","#ddd");var user_id=input.val();if(user_id.length<1||0==user_id)return input.css("border-color","#ff0000"),!1})},recount_stats:function(){$(document.body).on("change","#recount-stats-type",function(){var export_form=$("#pl8app-tools-recount-form"),selected_type=$("option:selected",this).data("type"),submit_button=$("#recount-stats-submit"),products=$("#tools-product-dropdown");if(export_form.find(".notice-wrap").remove(),submit_button.removeClass("button-disabled").attr("disabled",!1),products.hide(),$(".pl8app-recount-stats-descriptions span").hide(),"recount-menuitem"===selected_type)products.show(),products.find(".pl8app-select-chosen").css("width","auto");else if("reset-stats"===selected_type){export_form.append('<div class="notice-wrap"></div>'),export_form.find(".notice-wrap").html('<div class="notice notice-warning"><p><input type="checkbox" id="confirm-reset" name="confirm_reset_store" value="1" /> <label for="confirm-reset">'+pl8app_vars.reset_stats_warn+"</label></p></div>"),$("#recount-stats-submit").addClass("button-disabled").attr("disabled","disabled")}else products.hide(),products.val(0);$("#"+selected_type).show()}),$(document.body).on("change","#confirm-reset",function(){$(this).is(":checked")?$("#recount-stats-submit").removeClass("button-disabled").removeAttr("disabled"):$("#recount-stats-submit").addClass("button-disabled").attr("disabled","disabled")}),$("#pl8app-tools-recount-form").submit(function(e){var selection=$("#recount-stats-type").val(),export_form=$(this),selected_type=$("option:selected",this).data("type");if("reset-stats"===selected_type){if($("#confirm-reset").is(":checked"))return!0;has_errors=!0}export_form.find(".notice-wrap").remove(),export_form.append('<div class="notice-wrap"></div>');var notice_wrap=export_form.find(".notice-wrap"),has_errors=!1;(null!==selection&&0!==selection||(notice_wrap.html('<div class="updated error"><p>'+pl8app_vars.batch_export_no_class+"</p></div>"),has_errors=!0),"recount-menuitem"===selected_type)&&(0==$('select[name="menuitem_id"]').val()&&(notice_wrap.html('<div class="updated error"><p>'+pl8app_vars.batch_export_no_reqs+"</p></div>"),has_errors=!0));if(has_errors)return export_form.find(".button-disabled").removeClass("button-disabled"),!1})}}.init(),{init:function(){this.submit(),this.dismiss_message()},submit:function(){var self=this;$(document.body).on("submit",".pl8app-export-form",function(e){e.preventDefault();var submitButton=$(this).find('input[type="submit"]');if(!submitButton.hasClass("button-disabled")){var data=$(this).serialize();submitButton.addClass("button-disabled"),$(this).find(".notice-wrap").remove(),$(this).append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="pl8app-progress"><div></div></div></div>'),self.process_step(1,data,self)}})},process_step:function(step,data,self){$.ajax({type:"POST",url:ajaxurl,data:{form:data,action:"pl8app_do_ajax_export",step:step},dataType:"json",success:function(response){if("done"==response.step||response.error||response.success){var export_form=$(".pl8app-export-form").find(".pl8app-progress").parent().parent(),notice_wrap=export_form.find(".notice-wrap");if(export_form.find(".button-disabled").removeClass("button-disabled"),response.error){var error_message=response.message;notice_wrap.html('<div class="updated error"><p>'+error_message+"</p></div>")}else if(response.success){var success_message=response.message;notice_wrap.html('<div id="pl8app-batch-success" class="updated notice is-dismissible"><p>'+success_message+'<span class="notice-dismiss"></span></p></div>')}else notice_wrap.remove(),window.location=response.url}else $(".pl8app-progress div").animate({width:response.percentage+"%"},50,function(){}),self.process_step(parseInt(response.step),data,self)}}).fail(function(response){window.console&&window.console.log&&console.log(response)})},dismiss_message:function(){$(document.body).on("click","#pl8app-batch-success .notice-dismiss",function(){$("#pl8app-batch-success").parent().slideUp("fast")})}}.init();var pl8app_Import={init:function(){this.submit()},submit:function(){$(".pl8app-import-form").ajaxForm({beforeSubmit:this.before_submit,success:this.success,complete:this.complete,dataType:"json",error:this.error})},before_submit:function(arr,$form,options){if($form.find(".notice-wrap").remove(),$form.append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="pl8app-progress"><div></div></div></div>'),!(window.File&&window.FileReader&&window.FileList&&window.Blob)){var import_form=$(".pl8app-import-form").find(".pl8app-progress").parent().parent(),notice_wrap=import_form.find(".notice-wrap");return import_form.find(".button-disabled").removeClass("button-disabled"),notice_wrap.html('<div class="update error"><p>'+pl8app_vars.unsupported_browser+"</p></div>"),!1}},success:function(responseText,statusText,xhr,$form){},complete:function(xhr){var response=jQuery.parseJSON(xhr.responseText);if(response.success){var $form=$(".pl8app-import-form .notice-wrap").parent();$form.find(".pl8app-import-file-wrap,.notice-wrap").remove(),$form.find(".pl8app-import-options").slideDown();var select=$form.find("select.pl8app-import-csv-column"),options=(select.parents("tr").first(),""),columns=response.data.columns.sort(function(a,b){return a<b?-1:b<a?1:0});$.each(columns,function(key,value){options+='<option value="'+value+'">'+value+"</option>"}),select.append(options),select.on("change",function(){var $key=$(this).val();$key&&0!=response.data.first_row[$key]?$(this).parent().next().html(response.data.first_row[$key]):$(this).parent().next().html("")}),$.each(select,function(){$(this).val($(this).attr("data-field")).change()}),$(document.body).on("click",".pl8app-import-proceed",function(e){e.preventDefault(),$form.append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="pl8app-progress"><div></div></div></div>'),response.data.mapping=$form.serialize(),pl8app_Import.process_step(1,response.data,self)})}else pl8app_Import.error(xhr)},error:function(xhr){var response=jQuery.parseJSON(xhr.responseText),import_form=$(".pl8app-import-form").find(".pl8app-progress").parent().parent(),notice_wrap=import_form.find(".notice-wrap");import_form.find(".button-disabled").removeClass("button-disabled"),response.data.error?notice_wrap.html('<div class="update error"><p>'+response.data.error+"</p></div>"):notice_wrap.remove()},process_step:function(step,import_data,self){$.ajax({type:"POST",url:ajaxurl,data:{form:import_data.form,nonce:import_data.nonce,class:import_data.class,upload:import_data.upload,mapping:import_data.mapping,action:"pl8app_do_ajax_import",step:step},dataType:"json",success:function(response){if("done"==response.data.step||response.data.error){var import_form=$(".pl8app-import-form").find(".pl8app-progress").parent().parent(),notice_wrap=import_form.find(".notice-wrap");import_form.find(".button-disabled").removeClass("button-disabled"),response.data.error?notice_wrap.html('<div class="update error"><p>'+response.data.error+"</p></div>"):(import_form.find(".pl8app-import-options").hide(),$("html, body").animate({scrollTop:import_form.parent().offset().top},500),notice_wrap.html('<div class="updated"><p>'+response.data.message+"</p></div>"))}else $(".pl8app-progress div").animate({width:response.data.percentage+"%"},50,function(){}),pl8app_Import.process_step(parseInt(response.data.step),import_data,self)}}).fail(function(response){window.console&&window.console.log&&console.log(response)})}};pl8app_Import.init();var pl8app_Customer={vars:{customer_card_wrap_editable:$(".pl8app-customer-card-wrapper .editable"),customer_card_wrap_edit_item:$(".pl8app-customer-card-wrapper .edit-item"),user_id:$('input[name="customerinfo[user_id]"]'),state_input:$(':input[name="customerinfo[state]"]'),note:$("#customer-note")},init:function(){this.edit_customer(),this.add_email(),this.user_search(),this.remove_user(),this.cancel_edit(),this.change_country(),this.add_note(),this.delete_checked()},edit_customer:function(){$(document.body).on("click","#edit-customer",function(e){e.preventDefault(),pl8app_Customer.vars.customer_card_wrap_editable.hide(),pl8app_Customer.vars.customer_card_wrap_edit_item.fadeIn().css("display","block")})},add_email:function(){$(document.body).on("click","#add-customer-email",function(e){e.preventDefault();var button=$(this),wrapper=button.parent();wrapper.parent().find(".notice-container").remove(),wrapper.find(".spinner").css("visibility","visible"),button.attr("disabled",!0);var postData={pl8app_action:"customer-add-email",customer_id:wrapper.find('input[name="customer-id"]').val(),email:wrapper.find('input[name="additional-email"]').val(),primary:wrapper.find('input[name="make-additional-primary"]').is(":checked"),_wpnonce:wrapper.find('input[name="add_email_nonce"]').val()};$.post(ajaxurl,postData,function(response){!0===response.success?window.location.href=response.redirect:(button.attr("disabled",!1),wrapper.after('<div class="notice-container"><div class="notice notice-error inline"><p>'+response.message+"</p></div></div>"),wrapper.find(".spinner").css("visibility","hidden"))},"json")})},user_search:function(){$(document.body).on("click.pl8appSelectUser",".pl8app_user_search_results a",function(e){e.preventDefault();var user_id=$(this).data("userid");pl8app_Customer.vars.user_id.val(user_id)})},remove_user:function(){$(document.body).on("click","#disconnect-customer",function(e){if(e.preventDefault(),confirm(pl8app_vars.disconnect_customer)){var postData={pl8app_action:"disconnect-userid",customer_id:$('input[name="customerinfo[id]"]').val(),_wpnonce:$("#edit-customer-info #_wpnonce").val()};$.post(ajaxurl,postData,function(response){window.location.href=window.location.href},"json")}})},cancel_edit:function(){$(document.body).on("click","#pl8app-edit-customer-cancel",function(e){e.preventDefault(),pl8app_Customer.vars.customer_card_wrap_edit_item.hide(),pl8app_Customer.vars.customer_card_wrap_editable.show(),$(".pl8app_user_search_results").html("")})},change_country:function(){$('select[name="customerinfo[country]"]').change(function(){var data={action:"pl8app_get_states",country:$(this).val(),field_name:"customerinfo[state]"};return $.post(ajaxurl,data,function(response){"nostates"==response?pl8app_Customer.vars.state_input.replaceWith('<input type="text" name="'+data.field_name+'" value="" class="pl8app-edit-toggles medium-text"/>'):pl8app_Customer.vars.state_input.replaceWith(response)}),!1})},add_note:function(){$(document.body).on("click","#add-customer-note",function(e){e.preventDefault();var postData={pl8app_action:"add-customer-note",customer_id:$("#customer-id").val(),customer_note:pl8app_Customer.vars.note.val(),add_customer_note_nonce:$("#add_customer_note_nonce").val()};if(postData.customer_note)$.ajax({type:"POST",data:postData,url:ajaxurl,success:function(response){$("#pl8app-customer-notes").prepend(response),$(".pl8app-no-customer-notes").hide(),pl8app_Customer.vars.note.val("")}}).fail(function(data){window.console&&window.console.log&&console.log(data)});else{var border_color=pl8app_Customer.vars.note.css("border-color");pl8app_Customer.vars.note.css("border-color","red"),setTimeout(function(){pl8app_Customer.vars.note.css("border-color",border_color)},500)}})},delete_checked:function(){$("#pl8app-customer-delete-confirm").change(function(){var records_input=$("#pl8app-customer-delete-records"),submit_button=$("#pl8app-delete-customer");$(this).prop("checked")?(records_input.attr("disabled",!1),submit_button.attr("disabled",!1)):(records_input.attr("disabled",!0),records_input.prop("checked",!1),submit_button.attr("disabled",!0))})}};pl8app_Customer.init(),$(".pl8app-ajax-user-search").keyup(function(){var user_search=$(this).val(),exclude="";$(this).data("exclude")&&(exclude=$(this).data("exclude")),$(".pl8app-ajax").show();var data={action:"pl8app_search_users",user_name:user_search,exclude:exclude};document.body.style.cursor="wait",$.ajax({type:"POST",data:data,dataType:"json",url:ajaxurl,success:function(search_response){$(".pl8app-ajax").hide(),$(".pl8app_user_search_results").removeClass("hidden"),$(".pl8app_user_search_results span").html(""),$(search_response.results).appendTo(".pl8app_user_search_results span"),document.body.style.cursor="default"}})}),$(document.body).on("click.pl8appSelectUser",".pl8app_user_search_results span a",function(e){e.preventDefault();var login=$(this).data("login");$(".pl8app-ajax-user-search").val(login),$(".pl8app_user_search_results").addClass("hidden"),$(".pl8app_user_search_results span").html("")}),$(document.body).on("click.pl8appCancelUserSearch",".pl8app_user_search_results a.pl8app-ajax-user-cancel",function(e){e.preventDefault(),$(".pl8app-ajax-user-search").val(""),$(".pl8app_user_search_results").addClass("hidden"),$(".pl8app_user_search_results span").html("")}),$("#pl8app_dashboard_sales").length&&$.ajax({type:"GET",data:{action:"pl8app_load_dashboard_widget"},url:ajaxurl,success:function(response){$("#pl8app_dashboard_sales .inside").html(response)}}),$(document.body).on("keydown",".customer-note-input",function(e){13==e.keyCode&&(e.metaKey||e.ctrlKey)&&$("#add-customer-note").click()})});var pl8appFormatCurrency=function(value){var numeric=parseFloat(value),storeCurrency=pl8app_vars.currency,decimalPlaces=pl8app_vars.currency_decimals;return numeric.toLocaleString(storeCurrency,{style:"currency",currency:storeCurrency,minimumFractionDigits:decimalPlaces,maximumFractionDigits:decimalPlaces})},pl8appFormatNumber=function(value){var numeric=parseFloat(value),storeCurrency=pl8app_vars.currency;pl8app_vars.currency_decimals;return numeric.toLocaleString(storeCurrency,{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0})},pl8appLabelFormatter=function(label,series){return'<div style="font-size:12px; text-align:center; padding:2px">'+label+"</div>"},pl8appLegendFormatterSales=function(label,series){var slug=label.toLowerCase().replace(/\s/g,"-"),color='<div class="pl8app-legend-color" style="background-color: '+series.color+'"></div>',value='<div class="pl8app-pie-legend-item">'+label+": "+Math.round(series.percent)+"% ("+pl8appFormatNumber(series.data[0][1])+")</div>",item='<div id="'+series.pl8app_vars.id+slug+'" class="pl8app-legend-item-wrapper">'+color+value+"</div>";return jQuery("#pl8app-pie-legend-"+series.pl8app_vars.id).append(item),item},pl8appLegendFormatterEarnings=function(label,series){var slug=label.toLowerCase().replace(/\s/g,"-"),color='<div class="pl8app-legend-color" style="background-color: '+series.color+'"></div>',value='<div class="pl8app-pie-legend-item">'+label+": "+Math.round(series.percent)+"% ("+pl8appFormatCurrency(series.data[0][1])+")</div>",item='<div id="'+series.pl8app_vars.id+slug+'" class="pl8app-legend-item-wrapper">'+color+value+"</div>";return jQuery("#pl8app-pie-legend-"+series.pl8app_vars.id).append(item),item};function pl8app_attach_tooltips(selector){selector.tooltip({content:function(){return jQuery(this).prop("title")},tooltipClass:"pl8app-ui-tooltip",position:{my:"center top",at:"center bottom+10",collision:"flipfit"},hide:{duration:200},show:{duration:200}})}